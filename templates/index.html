{% extends "base.html" %}

{% block content %}
<!-- Page Header -->
<div class="row mb-5">
    <div class="col-12">
        <div class="text-center">
            <h1 class="mb-2">Email Security Toolkit</h1>
            <p class="text-muted">Professional email spoofing and domain security analysis tools</p>
        </div>
    </div>
</div>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="send-tab" data-bs-toggle="tab" data-bs-target="#send" type="button" role="tab">
            <i class="fas fa-paper-plane me-2"></i>Send Email
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="test-tab" data-bs-toggle="tab" data-bs-target="#test" type="button" role="tab">
            <i class="fas fa-plug me-2"></i>Test Connection
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="servers-tab" data-bs-toggle="tab" data-bs-target="#servers" type="button" role="tab">
            <i class="fas fa-server me-2"></i>Test Servers
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="domain-tab" data-bs-toggle="tab" data-bs-target="#domain" type="button" role="tab">
            <i class="fas fa-shield-alt me-2"></i>Domain Security
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="dkim-tab" data-bs-toggle="tab" data-bs-target="#dkim" type="button" role="tab">
            <i class="fas fa-key me-2"></i>DKIM Checker
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="headers-tab" data-bs-toggle="tab" data-bs-target="#headers" type="button" role="tab">
            <i class="fas fa-code me-2"></i>Header Analysis
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="mainTabsContent">
    <!-- Send Email Tab -->
    <div class="tab-pane fade show active" id="send" role="tabpanel">
        <form id="emailForm" enctype="multipart/form-data">
            <div class="row g-4">
                <!-- SMTP Configuration -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">SMTP Configuration</h3>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="smtp_server" class="form-label">SMTP Server</label>
                                <input type="text" class="form-control" id="smtp_server" name="smtp_server" 
                                       placeholder="smtp.gmail.com" required>
                                <div class="form-text">SMTP server hostname or IP address</div>
                            </div>
                            <div class="mb-3">
                                <label for="smtp_port" class="form-label">Port</label>
                                <input type="number" class="form-control" id="smtp_port" name="smtp_port" 
                                       value="25" min="1" max="65535" required>
                                <div class="form-text">Common ports: 25, 465 (SSL), 587 (TLS)</div>
                            </div>
                            <div class="mb-3">
                                <label for="username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="username" name="username" 
                                       placeholder="your-email@domain.com" required>
                            </div>
                            <div class="mb-0">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                                <div class="form-text">Use app-specific passwords for 2FA accounts</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sender Configuration -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Sender Configuration</h3>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="from_name" class="form-label">Display Name</label>
                                <input type="text" class="form-control" id="from_name" name="from_name" 
                                       placeholder="John Doe" required>
                            </div>
                            <div class="mb-3">
                                <label for="from_email" class="form-label">From Email</label>
                                <input type="email" class="form-control" id="from_email" name="from_email" 
                                       placeholder="spoofed@example.com" required>
                                <div class="form-text">This will appear as the sender</div>
                            </div>
                            <div class="mb-0">
                                <label for="reply_to" class="form-label">Reply-To Email</label>
                                <input type="email" class="form-control" id="reply_to" name="reply_to" 
                                       placeholder="replies@example.com">
                                <div class="form-text">Optional: Where replies should be sent</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipients -->
            <div class="row g-4 mt-2">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recipients</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="to_email" class="form-label">To</label>
                                    <input type="text" class="form-control" id="to_email" name="to_email" 
                                           placeholder="recipient@domain.com" required>
                                    <div class="form-text">Comma-separated for multiple</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="cc" class="form-label">CC</label>
                                    <input type="text" class="form-control" id="cc" name="cc" 
                                           placeholder="cc@domain.com">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="bcc" class="form-label">BCC</label>
                                    <input type="text" class="form-control" id="bcc" name="bcc" 
                                           placeholder="bcc@domain.com">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Content -->
            <div class="row g-4 mt-2">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Message Content</h3>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="subject" class="form-label">Subject</label>
                                <input type="text" class="form-control" id="subject" name="subject" 
                                       placeholder="Enter email subject">
                            </div>
                            <div class="mb-3">
                                <label for="message" class="form-label">Message</label>
                                <textarea class="form-control" id="message" name="message" rows="6" 
                                          placeholder="Enter your message here..."></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="attachments" class="form-label">Attachments</label>
                                    <input type="file" class="form-control" id="attachments" name="attachments" multiple>
                                    <div class="form-text">Max 16MB per file. Allowed: txt, pdf, images, doc</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Options</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="html" name="html" checked>
                                        <label class="form-check-label" for="html">HTML Format</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="add_xheaders" name="add_xheaders">
                                        <label class="form-check-label" for="add_xheaders">Add X-Headers</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="row mt-4">
                <div class="col-12 text-end">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-paper-plane me-2"></i>Send Email
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Test Connection Tab -->
    <div class="tab-pane fade" id="test" role="tabpanel">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Test SMTP Connection</h3>
                    </div>
                    <div class="card-body">
                        <form id="testForm">
                            <div class="mb-3">
                                <label for="test_smtp_server" class="form-label">SMTP Server</label>
                                <input type="text" class="form-control" id="test_smtp_server" name="smtp_server" required>
                            </div>
                            <div class="mb-3">
                                <label for="test_smtp_port" class="form-label">Port</label>
                                <input type="number" class="form-control" id="test_smtp_port" name="smtp_port" value="25" required>
                            </div>
                            <div class="mb-3">
                                <label for="test_username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="test_username" name="username" required>
                            </div>
                            <div class="mb-4">
                                <label for="test_password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="test_password" name="password" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-outline-primary">
                                    <i class="fas fa-plug me-2"></i>Test Connection
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Servers Tab -->
    <div class="tab-pane fade" id="servers" role="tabpanel">
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Bulk Server Testing</h3>
                    </div>
                    <div class="card-body">
                        <form id="serversForm">
                            <div class="mb-3">
                                <label for="smtp_file" class="form-label">SMTP Servers File</label>
                                <input type="file" class="form-control" id="smtp_file" name="smtp_file" accept=".txt" required>
                                <div class="form-text">Upload a text file with server credentials</div>
                            </div>
                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle me-2"></i>File Format:</h6>
                                <code>server|port|username|password</code><br>
                                <small>One server per line</small>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-outline-primary">
                                    <i class="fas fa-server me-2"></i>Test Servers
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div id="serversResults" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Working Servers</h3>
                        </div>
                        <div class="card-body">
                            <div id="serversList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Domain Security Tab -->
    <div class="tab-pane fade" id="domain" role="tabpanel">
        <div class="row">
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Domain Security Check</h3>
                    </div>
                    <div class="card-body">
                        <form id="spoofForm">
                            <div class="mb-3">
                                <label for="domain_check" class="form-label">Domain Name(s)</label>
                                <input type="text" class="form-control" id="domain_check" name="domain" 
                                       placeholder="example.com, google.com, microsoft.com" required>
                                <div class="form-text">Single domain or comma-separated list for bulk analysis</div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-shield-alt me-2"></i>Check Domain(s)
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-4">
                            <h6>What we check:</h6>
                            <ul class="list-unstyled small text-muted">
                                <li><i class="fas fa-check text-success me-2"></i>SPF records and policies</li>
                                <li><i class="fas fa-check text-success me-2"></i>DMARC records and policies</li>
                                <li><i class="fas fa-check text-success me-2"></i>Subdomain policy inheritance</li>
                                <li><i class="fas fa-check text-success me-2"></i>Spoofing vulnerability assessment</li>
                                <li><i class="fas fa-check text-success me-2"></i>Bulk analysis with summary statistics</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7">
                <div id="spoofResults" style="display: none;">
                    <div id="spoofAnalysis"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- DKIM Checker Tab -->
    <div class="tab-pane fade" id="dkim" role="tabpanel">
        <div class="row">
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">DKIM Record Checker</h3>
                    </div>
                    <div class="card-body">
                        <form id="dkimForm">
                            <div class="mb-3">
                                <label for="dkim_domain" class="form-label">Domain Name</label>
                                <input type="text" class="form-control" id="dkim_domain" name="domain" 
                                       placeholder="example.com" required>
                                <div class="form-text">Check DKIM records and selectors</div>
                            </div>
                            <div class="mb-3">
                                <label for="dkim_selectors" class="form-label">Custom Selectors (Optional)</label>
                                <input type="text" class="form-control" id="dkim_selectors" name="selectors" 
                                       placeholder="selector1,selector2,google">
                                <div class="form-text">Comma-separated list. Leave empty for common selectors.</div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-key me-2"></i>Check DKIM
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-4">
                            <h6>Common DKIM selectors checked:</h6>
                            <ul class="list-unstyled small text-muted">
                                <li><i class="fas fa-check text-success me-2"></i>default, google, k1, k2</li>
                                <li><i class="fas fa-check text-success me-2"></i>mail, dkim, s1, s2</li>
                                <li><i class="fas fa-check text-success me-2"></i>selector1, selector2</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7">
                <div id="dkimResults" style="display: none;">
                    <div id="dkimAnalysis"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header Analysis Tab -->
    <div class="tab-pane fade" id="headers" role="tabpanel">
        <div class="row">
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Email Header Analysis</h3>
                    </div>
                    <div class="card-body">
                        <form id="headersForm">
                            <div class="mb-3">
                                <label for="email_headers" class="form-label">Email Headers</label>
                                <textarea class="form-control" id="email_headers" name="headers" rows="10" 
                                          placeholder="Paste raw email headers here..." required></textarea>
                                <div class="form-text">Paste the complete email headers for analysis</div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search me-2"></i>Analyze Headers
                                </button>
                            </div>
                        </form>
                        
                        <div class="mt-4">
                            <h6>What we analyze:</h6>
                            <ul class="list-unstyled small text-muted">
                                <li><i class="fas fa-check text-success me-2"></i>SPF/DKIM/DMARC results</li>
                                <li><i class="fas fa-check text-success me-2"></i>Email routing chain</li>
                                <li><i class="fas fa-check text-success me-2"></i>Suspicious indicators</li>
                                <li><i class="fas fa-check text-success me-2"></i>Security score calculation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7">
                <div id="headersResults" style="display: none;">
                    <div id="headersAnalysis"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Report Generation Modal -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate Security Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Generate a comprehensive security assessment report based on your analysis results.</p>
                <div class="mb-3">
                    <label for="reportFormat" class="form-label">Report Format</label>
                    <select class="form-select" id="reportFormat">
                        <option value="html">HTML Report</option>
                        <option value="json">JSON Data</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generateReportBtn">
                    <i class="fas fa-file-alt me-2"></i>Generate Report
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}